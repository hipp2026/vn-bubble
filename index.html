<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>VN30 Bubbles</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/pixi.js@7/dist/pixi.min.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  background:#0b1220;
  overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,Inter,sans-serif;
}
#panel{
  position:fixed;
  top:12px;left:12px;
  background:#0f172a;
  color:#e5e7eb;
  padding:10px 14px;
  border-radius:14px;
  font-size:13px;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
  z-index:10;
}
#panel button{
  background:#020617;
  border:1px solid #1e293b;
  color:#e5e7eb;
  border-radius:10px;
  padding:4px 8px;
  margin:2px;
  cursor:pointer;
}
#panel button.active{background:#2563eb}
#tip{
  position:fixed;
  pointer-events:none;
  background:#020617;
  color:#e5e7eb;
  padding:8px 10px;
  border-radius:10px;
  font-size:12px;
  display:none;
  box-shadow:0 10px 25px rgba(0,0,0,.5);
}
</style>
</head>
<body>

<div id="panel">
  <b>VN30</b><br/>
  <button data-mode="price" class="active">% Price</button>
  <button data-mode="volume">Volume</button>
</div>
<div id="tip"></div>

<script>
/* ================= APP ================= */
const app=new PIXI.Application({
  resizeTo:window,
  backgroundColor:0x0b1220,
  antialias:true,
  autoDensity:true
});
document.body.appendChild(app.view);

/* ================= CAMERA ================= */
const world=new PIXI.Container();
app.stage.addChild(world);
let zoom=1, tx=0, ty=0;
function applyCam(){
  world.scale.set(zoom);
  world.position.set(tx,ty);
}
window.addEventListener("wheel",e=>{
  zoom*=e.deltaY>0?0.92:1.08;
  zoom=Math.max(.4,Math.min(2.5,zoom));
  applyCam();
});

/* ================= DATA ================= */
const DATA=[
 {s:"VCB",p:1.8,v:18,cap:450},
 {s:"BID",p:-0.6,v:15,cap:280},
 {s:"CTG",p:2.4,v:22,cap:200},
 {s:"FPT",p:3.2,v:12,cap:190},
 {s:"HPG",p:-1.2,v:30,cap:170},
 {s:"VPB",p:1.1,v:25,cap:140},
 {s:"TCB",p:0.4,v:20,cap:160},
 {s:"VHM",p:-2.1,v:14,cap:220},
 {s:"VNM",p:0.2,v:10,cap:180},
 {s:"MWG",p:-1.7,v:9,cap:90}
];

let mode="price";

/* ================= UTILS ================= */
const color=p=>p>0?0x22c55e:p<0?0xef4444:0x64748b;

/* ================= BUBBLE ================= */
class Bubble{
  constructor(d){
    this.d=d;
    this.r=20;
    this.x=Math.random()*800-400;
    this.y=Math.random()*600-300;
    this.vx=(Math.random()-.5)*2;
    this.vy=(Math.random()-.5)*2;
    this.pulse=Math.random()*10;

    this.g=new PIXI.Graphics();
    this.txt=new PIXI.Text(d.s,{fill:"#fff",fontSize:14,fontWeight:"700"});
    this.txt.anchor.set(.5);
    world.addChild(this.g,this.txt);

    this.g.interactive=true;
    this.g.on("pointerover",e=>showTip(e,d));
    this.g.on("pointerout",hideTip);
  }
  calc(){
    this.r=
      mode==="price"
        ?20+Math.abs(this.d.p)*6
        :20+this.d.v*1.5;
  }
  draw(){
    this.g.clear();
    const pr=this.r+Math.sin(this.pulse)*2;
    this.g.beginFill(color(this.d.p),.18);
    this.g.drawCircle(0,0,pr+6);
    this.g.endFill();
    this.g.beginFill(color(this.d.p),1);
    this.g.drawCircle(0,0,pr);
    this.g.endFill();
    this.g.position.set(this.x,this.y);
    this.txt.position.set(this.x,this.y+1);
  }
  step(){
    this.pulse+=0.05+this.d.v*0.002;
    this.x+=this.vx;this.y+=this.vy;
    this.vx*=0.99;this.vy*=0.99;
  }
}

const bubbles=DATA.map(d=>new Bubble(d));

/* ================= PHYSICS ================= */
function collide(){
  for(let i=0;i<bubbles.length;i++)
    for(let j=i+1;j<bubbles.length;j++){
      const a=bubbles[i],b=bubbles[j];
      const dx=b.x-a.x,dy=b.y-a.y;
      const dist=Math.hypot(dx,dy);
      const min=a.r+b.r+6;
      if(dist<min){
        const nx=dx/dist,ny=dy/dist;
        const push=(min-dist)*0.02;
        a.vx-=nx*push;a.vy-=ny*push;
        b.vx+=nx*push;b.vy+=ny*push;
      }
    }
}

/* ================= TOOLTIP ================= */
const tip=document.getElementById("tip");
function showTip(e,d){
  tip.style.display="block";
  tip.innerHTML=`<b>${d.s}</b><br/>%: ${d.p}<br/>Vol: ${d.v}`;
}
function hideTip(){tip.style.display="none";}
window.addEventListener("mousemove",e=>{
  tip.style.left=e.clientX+12+"px";
  tip.style.top=e.clientY+12+"px";
});

/* ================= UI ================= */
document.querySelectorAll("#panel button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll("#panel button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    mode=b.dataset.mode;
    bubbles.forEach(x=>x.calc());
  };
});

/* ================= LOOP ================= */
bubbles.forEach(b=>b.calc());
applyCam();
app.ticker.add(()=>{
  collide();
  bubbles.forEach(b=>{b.step();b.draw();});
});
</script>
</body>
</html>
