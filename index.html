<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√≤ng ti·ªÅn ch·ª©ng kho√°n VN - Real-time</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #e5e5e5;
        }
        header {
            padding: 12px 16px;
            font-size: 20px;
            font-weight: bold;
            background: #1E1E1E;
        }
        .card {
            margin: 20px;
            padding: 20px;
            background: #1E1E1E;
            border-radius: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 8px;
            font-size: 14px;
            text-align: center;
        }
        th {
            background: #282828;
            color: #aaa;
        }
        td {
            background: #202020;
        }
        .up {
            color: #22c55e;
        }
        .down {
            color: #ef4444;
        }
        .loading {
            font-size: 14px;
            color: #aaa;
        }
    </style>
</head>
<body>
<header>üìä D√≤ng ti·ªÅn ch·ª©ng kho√°n Vi·ªát Nam (Real-time)</header>

<div class="card">
    <b>Th·ªã Tr∆∞·ªùng: </b>
    <span id="status" class="loading">ƒêang k·∫øt n·ªëi WebSocket...</span>
</div>

<div class="card">
    <b>D·ªØ Li·ªáu Real-time</b>
    <table>
        <thead>
            <tr>
                <th>M√£</th>
                <th>Gi√° Hi·ªán T·∫°i</th>
                <th>Thay ƒê·ªïi (%)</th>
                <th>Kh·ªëi L∆∞·ª£ng GD</th>
            </tr>
        </thead>
        <tbody id="stock-table">
            <!-- D·ªØ li·ªáu t·ª´ WebSocket s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
        </tbody>
    </table>
</div>

<script>
    // ===================== CONFIG WEBSOCKET ======================
    const socket = new WebSocket("wss://price-vndirect.vndirect.com.vn/realtime");

    // M√£ ch·ª©ng kho√°n c·∫ßn theo d√µi
    const STOCK_CODES = ["VNM", "VCB", "HPG", "SSI"];

    // K·∫øt n·ªëi WebSocket
    socket.onopen = () => {
        console.log("WebSocket connected!");
        document.getElementById('status').innerText = "ƒê√£ k·∫øt n·ªëi WebSocket!";

        // G·ª≠i y√™u c·∫ßu subscribe (ƒëƒÉng k√Ω nh·∫≠n d·ªØ li·ªáu real-time)
        socket.send(JSON.stringify({
            type: "subscribe",
            codes: STOCK_CODES
        }));
    };

    // X·ª≠ l√Ω tin nh·∫Øn t·ª´ server
    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);

        // Ki·ªÉm tra ƒë·ªãnh d·∫°ng d·ªØ li·ªáu
        if (data.type === "price" && data.data) {
            // Hi·ªÉn th·ªã d·ªØ li·ªáu
            updateTable(data.data);
        }
    };

    // Hi·ªÉn th·ªã d·ªØ li·ªáu trong b·∫£ng
    function updateTable(data) {
        const table = document.getElementById("stock-table");
        table.innerHTML = ""; // X√≥a d·ªØ li·ªáu c≈©

        data.forEach((stock) => {
            const changeClass = stock.changePercent >= 0 ? "up" : "down";
            table.innerHTML += `
                <tr>
                    <td>${stock.code}</td>
                    <td>${stock.lastPrice}</td>
                    <td class="${changeClass}">${stock.changePercent.toFixed(2)}%</td>
                    <td>${stock.totalVolume}</td>
                </tr>
            `;
        });
    }

    // Khi k·∫øt n·ªëi b·ªã ƒë√≥ng
    socket.onclose = () => {
        console.log("WebSocket disconnected.");
        document.getElementById('status').innerText = "K·∫øt n·ªëi WebSocket b·ªã ƒë√≥ng!";
    };

    // X·ª≠ l√Ω l·ªói
    socket.onerror = (error) => {
        console.error("WebSocket Error: ", error);
        document.getElementById('status').innerText = "L·ªói WebSocket! Vui l√≤ng ki·ªÉm tra l·∫°i.";
    };
</script>

</body>
</html>