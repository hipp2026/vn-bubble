<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>D√≤ng ti·ªÅn ch·ª©ng kho√°n VN</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, Inter, Roboto, sans-serif;
  background: #0b0f1a;
  color: #e5e7eb;
}
header {
  padding: 12px 16px;
  font-size: 18px;
  font-weight: 600;
}
.card {
  background: #111827;
  border-radius: 10px;
  padding: 12px;
  margin: 12px 16px;
}
table {
  width: 100%;
  border-collapse: collapse;
  overflow-x: auto; /* ƒê·ªÉ kh√¥ng tr√†n m√†n h√¨nh */
  display: block;
}
th, td {
  padding: 8px;
  font-size: 14px;
  text-align: right;
}
th {
  color: #9ca3af;
  font-weight: 500;
}
td:first-child, th:first-child {
  text-align: left;
}
.up {
  color: #22c55e;
}
.down {
  color: #ef4444;
}
.tag {
  padding: 2px 6px;
  border-radius: 6px;
  font-size: 12px;
}
.in {
  background: #052e1b;
  color: #22c55e;
}
.out {
  background: #3f1d1d;
  color: #ef4444;
}
.loading {
  color: #9ca3af;
  font-size: 14px;
}
</style>
</head>
<body>

<header>üìä D√≤ng ti·ªÅn ch·ª©ng kho√°n Vi·ªát Nam</header>

<div class="card" id="market">ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>

<div class="card">
  <b>Top ti·ªÅn v√†o</b>
  <table>
    <thead><tr><th>M√£</th><th>GTGD</th><th>%</th><th>Ti·ªÅn</th></tr></thead>
    <tbody id="in"></tbody>
  </table>
</div>

<div class="card">
  <b>Top ti·ªÅn ra</b>
  <table>
    <thead><tr><th>M√£</th><th>GTGD</th><th>%</th><th>Ti·ªÅn</th></tr></thead>
    <tbody id="out"></tbody>
  </table>
</div>

<script>
// ================= CONFIG =================
// FireAnt public (qua proxy CORS)
// API URL l·∫•y d·ªØ li·ªáu t·ª´ proxy, bypass CORS
const API =
  "https://api.allorigins.win/get?url=" +
  encodeURIComponent("https://restv2.fireant.vn/symbols?exchange=HOSE");

function money(v, p) {
  return v * p;
}

function tag(val) {
  if (val > 0) return '<span class="tag in">V√ÄO</span>';
  if (val < 0) return '<span class="tag out">RA</span>';
  return "-";
}

function formatNumber(num) {
  return num.toLocaleString("vi-VN");
}

function fetchData() {
  // L·∫•y d·ªØ li·ªáu t·ª´ API
  fetch(API)
    .then((res) => res.json())
    .then((data) => {
      const rawData = JSON.parse(data.contents); // FireAnt data n·∫±m trong `contents`
      const list = rawData.slice(0, 100).map((x) => {
        const value = (x.price || 0) * (x.totalTradingVolume || 0) / 1e9; // ƒê∆°n v·ªã: t·ª∑
        const pct = x.percentChange ?? 0; // Tr√°nh `undefined`
        return {
          s: x.symbol,
          v: Math.round(value),
          p: pct,
          m: money(value, pct),
        };
      });

      // Chia m√£ theo d√≤ng ti·ªÅn v√†o/ra v√† x·∫øp h·∫°ng
      const moneyIn = [...list]
        .filter((x) => x.m > 0)
        .sort((a, b) => b.m - a.m)
        .slice(0, 10);
      const moneyOut = [...list]
        .filter((x) => x.m < 0)
        .sort((a, b) => a.m - b.m)
        .slice(0, 10);

      // C·∫≠p nh·∫≠t DOM ph·∫ßn t·ªïng quan
      market.innerHTML = `
        <b>HOSE (Realtime)</b><br>
        S·ªë m√£: ${list.length}<br>
        T·ªïng d√≤ng ti·ªÅn: <b>${Math.round(
          list.reduce((a, b) => a + b.m, 0)
        )} t·ª∑</b>
      `;

      // C·∫≠p nh·∫≠t DOM cho ph·∫ßn top ti·ªÅn v√†o
      in.innerHTML = moneyIn
        .map(
          (x) => `
        <tr>
          <td><b>${x.s}</b></td>
          <td>${formatNumber(x.v)}</td>
          <td class="up">+${x.p}%</td>
          <td>${tag(x.m)}</td>
        </tr>
      `
        )
        .join("");

      // C·∫≠p nh·∫≠t DOM cho ph·∫ßn top ti·ªÅn ra
      out.innerHTML = moneyOut
        .map(
          (x) => `
        <tr>
          <td><b>${x.s}</b></td>
          <td>${formatNumber(x.v)}</td>
          <td class="down">${x.p}%</td>
          <td>${tag(x.m)}</td>
        </tr>
      `
        )
        .join("");
    })
    .catch((err) => {
      // X·ª≠ l√Ω l·ªói k·∫øt n·ªëi API
      console.error(err);
      market.innerHTML =
        '<span class="loading">API kh√¥ng ph·∫£n h·ªìi. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c th·ª≠ l·∫°i sau.</span>';
    });
}

// G·ªçi l·∫ßn ƒë·∫ßu khi t·∫£i trang
fetchData();
// C·∫≠p nh·∫≠t d·ªØ li·ªáu sau m·ªói ph√∫t
setInterval(fetchData, 60000); // T·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói 60s
</script>

</body>
</html>