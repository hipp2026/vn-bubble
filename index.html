<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>D√≤ng ti·ªÅn ch·ª©ng kho√°n VN</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, Inter, Roboto, sans-serif;
            background: #0b0f1a;
            color: #e5e7eb;
        }
        header {
            padding: 12px 16px;
            font-size: 18px;
            font-weight: 600;
        }
        .card {
            background: #111827;
            border-radius: 10px;
            padding: 12px;
            margin: 12px 16px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th,
        td {
            padding: 8px;
            font-size: 14px;
            text-align: right;
        }
        th {
            color: #9ca3af;
            font-weight: 500;
        }
        td:first-child,
        th:first-child {
            text-align: left;
        }
        .up {
            color: #22c55e;
        }
        .down {
            color: #ef4444;
        }
        .tag {
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 12px;
        }
        .in {
            background: #052e1b;
            color: #22c55e;
        }
        .out {
            background: #3f1d1d;
            color: #ef4444;
        }
        .loading {
            color: #9ca3af;
            font-size: 14px;
        }
    </style>
</head>

<body>

<header>üìä D√≤ng ti·ªÅn ch·ª©ng kho√°n Vi·ªát Nam</header>

<div class="card" id="market">ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>

<div class="card">
    <b>Top ti·ªÅn v√†o</b>
    <table>
        <thead>
            <tr>
                <th>M√£</th>
                <th>GTGD</th>
                <th>%</th>
                <th>Ti·ªÅn</th>
            </tr>
        </thead>
        <tbody id="in"></tbody>
    </table>
</div>

<div class="card">
    <b>Top ti·ªÅn ra</b>
    <table>
        <thead>
            <tr>
                <th>M√£</th>
                <th>GTGD</th>
                <th>%</th>
                <th>Ti·ªÅn</th>
            </tr>
        </thead>
        <tbody id="out"></tbody>
    </table>
</div>

<script>
// ================= CONFIG =================
// Marketstack API Key (thay 'YOUR_API_KEY' b·∫±ng API Key c·ªßa b·∫°n)
const API_KEY = 'YOUR_API_KEY';
const API_URL = `http://api.marketstack.com/v1/eod?access_key=${API_KEY}&symbols=`;

// Danh s√°ch c√°c m√£ c·ªï phi·∫øu c·∫ßn theo d√µi (m√£ HOSE, HNX)
const STOCK_SYMBOLS = ['VNM', 'VCB', 'SSI', 'HDB', 'HPG'];

// ================= LOGIC =================
function fetchStockData() {
    const symbols = STOCK_SYMBOLS.join(',');
    const url = `${API_URL}${symbols}`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            if (!data || !data.data) {
                throw new Error('Kh√¥ng nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu t·ª´ API.');
            }

            // X·ª≠ l√Ω d·ªØ li·ªáu
            const list = data.data.map(stock => {
                const value = stock.close; // Gi√° ƒë√≥ng c·ª≠a c·ªßa c·ªï phi·∫øu
                const pct = ((stock.close - stock.open) / stock.open) * 100; // Ph·∫ßn trƒÉm thay ƒë·ªïi
                return {
                    s: stock.symbol,
                    v: value.toFixed(2),
                    p: pct.toFixed(2),
                    m: (value * pct).toFixed(2)
                };
            });

            // Top ti·ªÅn v√†o v√† ti·ªÅn ra
            const moneyIn = [...list].filter(x => x.p > 0).sort((a, b) => b.m - a.m).slice(0, 10);
            const moneyOut = [...list].filter(x => x.p < 0).sort((a, b) => a.m - b.m).slice(0, 10);

            updateUI(list, moneyIn, moneyOut);
        })
        .catch(error => {
            console.error(error);
            document.getElementById('market').innerHTML = '<span class="loading">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra API Key!</span>';
        });
}

function updateUI(list, moneyIn, moneyOut) {
    // C·∫≠p nh·∫≠t th·ªã tr∆∞·ªùng
    document.getElementById('market').innerHTML = `
        <b>Th·ªã tr∆∞·ªùng (Realtime)</b><br>
        S·ªë m√£ theo d√µi: ${list.length}<br>
        T·ªïng s·ªë ti·ªÅn giao d·ªãch: <b>${list.reduce((total, x) => total + parseFloat(x.m), 0).toFixed(2)} t·ª∑</b>
    `;

    // C·∫≠p nh·∫≠t top ti·ªÅn v√†o
    document.getElementById('in').innerHTML = moneyIn.map(x => `
        <tr>
            <td><b>${x.s}</b></td>
            <td>${x.v} VNƒê</td>
            <td class="up">+${x.p}%</td>
            <td>${x.m} VNƒê</td>
        </tr>
    `).join('');

    // C·∫≠p nh·∫≠t top ti·ªÅn ra
    document.getElementById('out').innerHTML = moneyOut.map(x => `
        <tr>
            <td><b>${x.s}</b></td>
            <td>${x.v} VNƒê</td>
            <td class="down">${x.p}%</td>
            <td>${x.m} VNƒê</td>
        </tr>
    `).join('');
}

// ================= START =================
fetchStockData();
setInterval(fetchStockData, 60000); // T·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói ph√∫t
</script>

</body>

</html>